<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Earning Platform</title>

<!-- Monetag SDK -->
<script src='//libtl.com/sdk.js' data-zone='9789039' data-sdk='show_9789039'></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* Basic Styling */
body { font-family: Arial, sans-serif; background: #121212; color: #e0e0e0; margin: 0; padding: 20px; }
.container { max-width: 500px; margin: auto; }
h1, h2 { color: #fff; }
.btn { width: 100%; padding: 15px; border: none; border-radius: 10px; margin-top: 10px; cursor: pointer; font-weight: bold; }
.btn:disabled { background: #555; cursor: not-allowed; }
.status-message { padding: 10px; margin: 10px 0; display: none; border-radius: 8px; }
.success { background-color: #28a74533; color: #28a745; }
.error { background-color: #dc354533; color: #dc3545; }
.info { background-color: #007bff33; color: #007bff; }
.ad-buttons { margin: 15px 0; }
.footer-nav { display: flex; justify-content: space-around; position: fixed; bottom:0; width:100%; background:#1e1e1e; padding:10px 0; border-top:1px solid #333; }
.nav-btn { color: #8a8a8a; cursor: pointer; text-align: center; }
.nav-btn.active { color: #00aaff; }
</style>
</head>
<body>

<div class="container">
    <div id="home-view">
        <h1>Earning Platform</h1>
        <p>Watch Ads & Earn USDT</p>
        <div class="card">
            <h2>Balance: <span id="balanceDisplay">USDT 0.00</span></h2>
            <div class="ad-info-grid">
                <div class="ad-info-item">Ads Today: <span id="dailyAdCountDisplay">0/20</span></div>
                <div class="ad-info-item">Total Ads: <span id="adCountDisplay">0</span></div>
            </div>
        </div>
        <div class="ad-buttons">
            <button class="btn" id="rewardedBtn">Watch Ad (+0.02 cents)</button>
        </div>
        <div class="ad-buttons">
            <h2>Referral Link (0.05 cents per referral)</h2>
            <p id="referralLink" style="cursor:pointer; background:#111; padding:10px; border-radius:8px; word-break:break-word;"></p>
        </div>
        <button class="btn" id="mainWithdrawBtn" disabled>Withdraw (20 USD minimum)</button>
    </div>

    <div id="withdraw-view" class="view" style="display:none;">
        <h1>Withdraw</h1>
        <p>Choose account to withdraw:</p>
        <div class="ad-buttons">
            <button class="btn">Binance</button>
            <button class="btn">Bybit</button>
            <button class="btn">PayPal</button>
        </div>
        <div class="input-group">
            <label>USDT Wallet Address:</label>
            <input type="text" id="paymentAddress" placeholder="T...">
        </div>
        <button class="btn" id="finalWithdrawBtn" disabled>Withdraw</button>
    </div>

    <div class="status-message" id="statusMessage"></div>
</div>

<footer class="footer-nav">
    <div class="nav-btn active" id="navHome">Home</div>
    <div class="nav-btn" id="navWithdraw">Withdraw</div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const tg = window.Telegram.WebApp;

    // DOM Elements
    const balanceDisplay = document.getElementById('balanceDisplay'),
          dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay'),
          adCountDisplay = document.getElementById('adCountDisplay'),
          rewardedBtn = document.getElementById('rewardedBtn'),
          mainWithdrawBtn = document.getElementById('mainWithdrawBtn'),
          finalWithdrawBtn = document.getElementById('finalWithdrawBtn'),
          statusMessage = document.getElementById('statusMessage'),
          paymentAddressInput = document.getElementById('paymentAddress'),
          referralLinkDisplay = document.getElementById('referralLink');

    const WITHDRAW_THRESHOLD = 20; // USD
    const AD_REWARD_CENTS = 2; // 0.02 cents
    const REFERRAL_BONUS_CENTS = 5; // 0.05 cents
    const DAILY_AD_LIMIT = 20;

    // App State (reset for new users)
    let state = {
        balanceInCents: 0,
        dailyAdCount: 0,
        totalAdCount: 0,
        referralCount: 0,
        lastAdDate: null
    };

    function getTodayDateString() { return new Date().toISOString().split('T')[0]; }

    // Reset daily ads automatically
    function resetDailyAds() {
        if(state.lastAdDate !== getTodayDateString()){
            state.dailyAdCount = 0;
            state.lastAdDate = getTodayDateString();
            updateUI();
        }
    }

    function updateUI() {
        const balanceUSD = (state.balanceInCents/100).toFixed(2);
        balanceDisplay.textContent = `USDT ${balanceUSD}`;
        dailyAdCountDisplay.textContent = `${state.dailyAdCount}/${DAILY_AD_LIMIT}`;
        adCountDisplay.textContent = state.totalAdCount;
        mainWithdrawBtn.disabled = parseFloat(balanceUSD) < WITHDRAW_THRESHOLD;
        finalWithdrawBtn.disabled = parseFloat(balanceUSD) < WITHDRAW_THRESHOLD;
    }

    function showStatus(message, type='info', duration=3000){
        statusMessage.textContent = message;
        statusMessage.className = `status-message ${type}`;
        statusMessage.style.display = 'block';
        setTimeout(()=>{statusMessage.style.display='none';}, duration);
    }

    // Generate Referral Link
    function generateReferralLink(){
        const user = tg.initDataUnsafe.user;
        if(user && user.id){
            referralLinkDisplay.textContent = `https://t.me/Monetag_alamin_bot/Monetag_alamin?startapp=ref${user.id}`;
        }
    }

    // Ad Watching
    function requestAd(){
        resetDailyAds();
        if(state.dailyAdCount >= DAILY_AD_LIMIT){
            showStatus("Daily ad limit reached", 'error');
            return;
        }
        showStatus("Loading ad...", 'info');
        show_9789039().then(()=>{
            state.dailyAdCount++;
            state.totalAdCount++;
            state.balanceInCents += AD_REWARD_CENTS;
            showStatus("+0.02 cents added!", 'success');
            updateUI();
        }).catch(err=>{
            console.error(err);
            showStatus("Ad failed to load.", 'error');
        });
    }

    function handleWithdraw(){
        const wallet = paymentAddressInput.value.trim();
        if(!wallet || !wallet.startsWith('T')){
            showStatus("Enter valid wallet address", 'error');
            return;
        }
        const balanceUSD = (state.balanceInCents/100).toFixed(2);
        if(balanceUSD < WITHDRAW_THRESHOLD){
            showStatus("Minimum 20 USD required", 'error');
            return;
        }
        showStatus(`Withdraw request sent: ${balanceUSD} USD`, 'success');
        state.balanceInCents = 0; // reset after withdraw
        updateUI();
        paymentAddressInput.value = '';
        showView('home-view');
    }

    function showView(viewId){
        document.querySelectorAll('.view').forEach(v=>v.style.display='none');
        document.getElementById(viewId).style.display='block';
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        const navId = viewId==='home-view'?'navHome':'navWithdraw';
        document.getElementById(navId).classList.add('active');
    }

    // Event Listeners
    rewardedBtn.addEventListener('click', requestAd);
    finalWithdrawBtn.addEventListener('click', handleWithdraw);
    mainWithdrawBtn.addEventListener('click', ()=>showView('withdraw-view'));
    document.getElementById('navHome').addEventListener('click', ()=>showView('home-view'));
    document.getElementById('navWithdraw').addEventListener('click', ()=>showView('withdraw-view'));
    referralLinkDisplay.addEventListener('click', ()=>{navigator.clipboard.writeText(referralLinkDisplay.textContent); showStatus("Referral link copied!", 'success');});

    // Initialization
    tg.ready();
    tg.expand();
    generateReferralLink();
    resetDailyAds();
    updateUI();
});
</script>

</body>
</html>
