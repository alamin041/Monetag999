<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Earning Platform</title>
<script src="//libtl.com/sdk.js" data-zone="9789039" data-sdk="show_9789039"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --btn-color: #007bff;
    --btn-text: #fff;
    --secondary-bg: #1e1e1e;
    --border-color: #333;
    --success-color: #28a745;
    --danger-color: #dc3545;
}
body {
    font-family: Arial, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px 15px 90px 15px;
    display: flex; flex-direction: column; align-items: center; min-height:100vh;
}
.container { width:100%; max-width:500px; }
.view { display:none; animation:fadeIn 0.3s ease-in-out; }
#home-view { display:block; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
.header { margin-bottom:25px; }
.header h1 { font-size:32px; margin:0 0 5px 0; color:#fff; }
.header p { color:#8a8a8a; margin:0; }
.card { background:var(--secondary-bg); padding:25px; border-radius:16px; margin-bottom:25px; border:1px solid var(--border-color); }
.card h2 { margin:0 0 12px 0; font-size:16px; color:#8a8a8a; font-weight:500; text-transform:uppercase; letter-spacing:0.5px; }
.balance-amount { font-size:42px; font-weight:700; color:#fff; margin-bottom:10px; }
.ad-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:center; }
.ad-info-item h3 { font-size:20px; margin:0; color:#fff; }
.ad-info-item p { font-size:14px; color:#8a8a8a; margin:0; }
.ad-buttons { display:flex; flex-direction:column; gap:15px; margin-bottom:25px; }
.btn { width:100%; padding:16px; font-size:18px; font-weight:600; border:none; border-radius:12px; cursor:pointer; background:var(--btn-color); color:var(--btn-text); transition: transform 0.2s; }
.btn:hover { transform:translateY(-2px); }
.btn:disabled { background:#555; color:#888; cursor:not-allowed; }
#mainWithdrawBtn { background: var(--success-color); color:#fff; }
.status-message { position:fixed; bottom:80px; left:50%; transform:translateX(-50%); width:90%; max-width:480px; padding:12px 15px; border-radius:10px; font-weight:500; display:none; z-index:1000; }
.success { background:rgba(40,167,69,0.25); border-left:5px solid var(--success-color); color:var(--success-color); }
.error { background:rgba(220,53,69,0.25); border-left:5px solid var(--danger-color); color:var(--danger-color); }
.footer-nav { position:fixed; bottom:0; left:0; right:0; background:var(--secondary-bg); display:flex; justify-content:space-around; padding:10px 0; border-top:1px solid var(--border-color); }
.nav-btn { background:none; border:none; color:#8a8a8a; cursor:pointer; display:flex; flex-direction:column; align-items:center; font-size:12px; font-weight:500; padding:5px 15px; border-radius:12px; }
.nav-btn.active { color:var(--btn-color); }
.nav-btn .icon { width:28px; height:28px; margin-bottom:4px; }
</style>
</head>
<body>
<div class="container">

<div id="home-view" class="view">
    <div class="header"><h1>Earning Platform</h1><p>Watch Ads and Earn USDT</p></div>
    <div class="card">
        <h2>Current Balance</h2>
        <div class="balance-amount" id="balanceDisplay">USDT 0.00</div>
        <div class="ad-info-grid">
            <div class="ad-info-item"><h3 id="adCountDisplay">0</h3><p>Total Ads Watched</p></div>
            <div class="ad-info-item"><h3 id="dailyAdCountDisplay">0/20</h3><p>Today's Ads</p></div>
        </div>
    </div>
    <div class="ad-buttons">
        <button class="btn" id="rewardedBtn">Watch Ad (+0.02 cents)</button>
    </div>
</div>

<div id="referral-view" class="view">
    <div class="header"><h1>Referral & Withdraw</h1></div>
    <div class="card">
        <h2>Referral Link</h2>
        <p id="referralLink" style="cursor:pointer; background:#111; padding:10px; border-radius:8px; word-break:break-word;"></p>
    </div>
    <div class="ad-buttons">
        <button class="btn" id="mainWithdrawBtn" disabled>Withdraw (20 USD minimum)</button>
    </div>
</div>

<div class="status-message" id="statusMessage"></div>
</div>

<footer class="footer-nav">
    <button class="nav-btn active" id="navHome"><span class="icon">üè†</span>Home</button>
    <button class="nav-btn" id="navReferral"><span class="icon">üí∞</span>Referral</button>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function(){
    const tg = window.Telegram.WebApp;
    const balanceDisplay = document.getElementById('balanceDisplay');
    const adCountDisplay = document.getElementById('adCountDisplay');
    const dailyAdCountDisplay = document.getElementById('dailyAdCountDisplay');
    const rewardedBtn = document.getElementById('rewardedBtn');
    const mainWithdrawBtn = document.getElementById('mainWithdrawBtn');
    const statusMessage = document.getElementById('statusMessage');
    const referralLinkDisplay = document.getElementById('referralLink');

    const WITHDRAW_THRESHOLD = 2000; // 20 USD in cents
    const AD_REWARD_CENTS = 2; // 0.02 cents
    const REFERRAL_BONUS_CENTS = 5; // 0.05 cents
    const DAILY_AD_LIMIT = 20;

    let state = {
        balanceInCents:0,
        dailyAdCount:0,
        totalAdCount:0,
        lastAdDate:null
    };

    function getTodayDateString(){ return new Date().toISOString().split('T')[0]; }

    function resetDailyAds(){
        if(state.lastAdDate !== getTodayDateString()){
            state.dailyAdCount = 0;
            state.lastAdDate = getTodayDateString();
            updateUI();
        }
    }

    function updateUI(){
        const bal = (state.balanceInCents/100).toFixed(2);
        balanceDisplay.textContent = `USDT ${bal}`;
        dailyAdCountDisplay.textContent = `${state.dailyAdCount}/${DAILY_AD_LIMIT}`;
        adCountDisplay.textContent = state.totalAdCount;
        mainWithdrawBtn.disabled = bal < (WITHDRAW_THRESHOLD/100);
    }

    function showStatus(msg,type='info',dur=3000){
        statusMessage.textContent=msg;
        statusMessage.className=`status-message ${type}`;
        statusMessage.style.display='block';
        setTimeout(()=>{statusMessage.style.display='none';},dur);
    }

    function generateReferralLink(){
        const user = tg.initDataUnsafe.user;
        if(user && user.id){
            referralLinkDisplay.textContent = `https://t.me/Monetag_alamin_bot?start=ref${user.id}`;
        }
    }

    function watchAd(){
        resetDailyAds();
        if(state.dailyAdCount>=DAILY_AD_LIMIT){
            showStatus("Daily ad limit reached","error");
            return;
        }
        showStatus("Loading Ad...","info");
        show_9789039().then(()=>{
            // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶ó‡ßá‡¶≤‡ßá ‡¶ï‡§æ‡§â‡§Ç‡§ü ‡¶¨‡¶æ‡ßú‡¶¨‡ßá
            state.dailyAdCount++;
            state.totalAdCount++;
            state.balanceInCents += AD_REWARD_CENTS;
            updateUI();
            showStatus("+0.02 cents added!","success");
        }).catch(err=>{
            console.error(err);
            showStatus("Ad failed","error");
        });
    }

    rewardedBtn.addEventListener('click',watchAd);

    document.getElementById('navHome').addEventListener('click',()=>{
        document.getElementById('home-view').style.display='block';
        document.getElementById('referral-view').style.display='none';
        document.getElementById('navHome').classList.add('active');
        document.getElementById('navReferral').classList.remove('active');
    });
    document.getElementById('navReferral').addEventListener('click',()=>{
        document.getElementById('home-view').style.display='none';
        document.getElementById('referral-view').style.display='block';
        document.getElementById('navHome').classList.remove('active');
        document.getElementById('navReferral').classList.add('active');
        generateReferralLink();
    });

    mainWithdrawBtn.addEventListener('click',()=>{
        if((state.balanceInCents/100)<20){
            showStatus("Minimum 20 USD required","error");
            return;
        }
        showStatus(`Withdraw request sent: ${(state.balanceInCents/100).toFixed(2)} USD`,"success");
        state.balanceInCents = 0;
        updateUI();
    });

    tg.ready();
    tg.expand();
    resetDailyAds();
    updateUI();
});
</script>
</body>
</html>
